#!/usr/bin/make -f
# -*- makefile -*-
# Sample debian/rules that uses debhelper.
# This file was originally written by Joey Hess and Craig Small.
# As a special exception, when this file is copied by dh-make into a
# dh-make output file, you may use that output file without restriction.
# This special exception was added by Craig Small in version 0.37 of dh-make.

# Uncomment this to turn on verbose mode.
export DH_VERBOSE=1

# include system information
include /usr/share/dpkg/architecture.mk

# set CROSS_COMPILE only when cross-compiling
CROSS_COMPILE=
ifneq ($(DEB_HOST_GNU_TYPE),$(DEB_BUILD_GNU_TYPE))
	CROSS_COMPILE=$(DEB_HOST_GNU_TYPE)-
endif

# hack: will only work on OBS-created chroots
SOURCESDIRS=/usr/src/packages/SOURCES/ ~/

%:
	dh $@ --parallel

override_dh_auto_clean:
	find . -type d -iname "imx-gpu-viv-*-*" -exec rm -rf {} \; || true
	rm -vf *.bin
build: 

override_dh_auto_install:
	find $(SOURCESDIRS) -maxdepth 1 -iname "imx-gpu-viv-*.bin" -exec cp -v {} ./ \; || true
	CROSS_COMPILE=$(CROSS_COMPILE) ./install.sh --destdir $(CURDIR)/debian/tmp --libdir /usr/lib/$(DEB_HOST_MULTIARCH) --dridir /usr/lib/arm-linux-gnueabihf/dri --fhw hard
	install -v -m644 -D vivante.profile.sh $(CURDIR)/debian/tmp/etc/profile.d/vivante.sh

override_dh_shlibdeps:
	dh_shlibdeps -l$(CURDIR):$(CURDIR)/debian/imx-gpu-viv/usr/lib/$(DEB_HOST_MULTIARCH)/vivante -pimx-gpu-viv -- -ximx-gpu-viv-fb -ximx-gpu-viv-wl -ximx-gpu-viv-x11
	dh_shlibdeps -l$(CURDIR):$(CURDIR)/debian/imx-gpu-viv/usr/lib/$(DEB_HOST_MULTIARCH)/vivante:$(CURDIR)/debian/imx-gpu-viv-fb/usr/lib/$(DEB_HOST_MULTIARCH)/vivante -pimx-gpu-viv-fb -- -ximx-gpu-viv-fb -ximx-gpu-viv-wl -ximx-gpu-viv-x11
	dh_shlibdeps -l$(CURDIR):$(CURDIR)/debian/imx-gpu-viv/usr/lib/$(DEB_HOST_MULTIARCH)/vivante:$(CURDIR)/debian/imx-gpu-viv-wl/usr/lib/$(DEB_HOST_MULTIARCH)/vivante -pimx-gpu-viv-wl -- -ximx-gpu-viv-fb -ximx-gpu-viv-wl -ximx-gpu-viv-x11
	dh_shlibdeps -l$(CURDIR):$(CURDIR)/debian/imx-gpu-viv/usr/lib/$(DEB_HOST_MULTIARCH)/vivante:$(CURDIR)/debian/imx-gpu-viv-x11/usr/lib/$(DEB_HOST_MULTIARCH)/vivante -pimx-gpu-viv-x11 -- -ximx-gpu-viv-fb -ximx-gpu-viv-wl -ximx-gpu-viv-x11
	#dh_shlibdeps -l$(CURDIR):$(CURDIR)/debian/imx-gpu-viv/usr/lib/$(DEB_HOST_MULTIARCH)/vivante -pimx-gpu-viv-demos -- -ximx-gpu-viv-fb -ximx-gpu-viv-wl -ximx-gpu-viv-x11

override_dh_strip:
	dh_strip --package=imx-gpu-viv --dbg-package=imx-gpu-viv-dbg
	dh_strip --package=imx-gpu-viv-fb --dbg-package=imx-gpu-viv-fb-dbg
	dh_strip --package=imx-gpu-viv-x11 --dbg-package=imx-gpu-viv-x11-dbg
	dh_strip --package=imx-gpu-viv-wl --dbg-package=imx-gpu-viv-wl-dbg
